globalThis.monorepoPackagePath = "";import process from 'node:process';import { Buffer } from 'node:buffer';import { createRequire as topLevelCreateRequire } from 'module';const require = topLevelCreateRequire(import.meta.url);import bannerUrl from 'url';const __dirname = bannerUrl.fileURLToPath(new URL('.', import.meta.url));globalThis.openNextDebug = false;globalThis.openNextVersion = "3.7.4";
var St=Object.create;var se=Object.defineProperty;var Pt=Object.getOwnPropertyDescriptor;var Nt=Object.getOwnPropertyNames;var Tt=Object.getPrototypeOf,At=Object.prototype.hasOwnProperty;var N=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var y=(e,t)=>()=>(e&&(t=e(e=0)),t);var Lt=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),C=(e,t)=>{for(var r in t)se(e,r,{get:t[r],enumerable:!0})},kt=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Nt(t))!At.call(e,a)&&a!==r&&se(e,a,{get:()=>t[a],enumerable:!(o=Pt(t,a))||o.enumerable});return e};var Ht=(e,t,r)=>(r=e!=null?St(Tt(e)):{},kt(t||!e||!e.__esModule?se(r,"default",{value:e,enumerable:!0}):r,e));function q(e){try{return"__openNextInternal"in e}catch{return!1}}var M,V,J=y(()=>{M=class extends Error{__openNextInternal=!0;canIgnore=!0;logLevel=0;constructor(t){super(t),this.name="IgnorableError"}},V=class extends Error{__openNextInternal=!0;canIgnore=!1;logLevel=2;constructor(t){super(t),this.name="FatalError"}}});function u(...e){globalThis.openNextDebug&&console.log(...e)}function Mt(...e){console.warn(...e)}function R(...e){if(e.some(t=>Ot(t)))return u(...e);if(e.some(t=>q(t))){let t=e.find(r=>q(r));return t.logLevel<jt()?void 0:t.logLevel===0?console.log(...e.map(r=>q(r)?`${r.name}: ${r.message}`:r)):t.logLevel===1?Mt(...e.map(r=>q(r)?`${r.name}: ${r.message}`:r)):console.error(...e)}console.error(...e)}function jt(){switch((process.env.OPEN_NEXT_ERROR_LOG_LEVEL??"1").toLowerCase()){case"debug":case"0":return 0;case"error":case"2":return 2;default:return 1}}var It,Ot,w=y(()=>{J();It=[{clientName:"S3Client",commandName:"GetObjectCommand",errorName:"NoSuchKey"}],Ot=e=>It.some(t=>t.clientName===e?.clientName&&t.commandName===e?.commandName&&(t.errorName===e?.error?.name||t.errorName===e?.error?.Code))});function Y(e){return e?typeof e=="string"?e.split(/(?<!Expires=\w+),/i).map(t=>t.trim()):e:[]}function le(e){let t={};for(let[r,o]of e)r in t?Array.isArray(t[r])?t[r].push(o):t[r]=[t[r],o]:t[r]=o;return t}var K,Ut,B=y(()=>{K=e=>{let t={};if(!e)return t;for(let[r,o]of Object.entries(e))o!==void 0&&(t[r.toLowerCase()]=Ut(o));return t},Ut=e=>typeof e=="string"?e:Array.isArray(e)?e.join(","):String(e)});import{Readable as te}from"node:stream";function I(){return process.env.OPEN_NEXT_FORCE_NON_EMPTY_RESPONSE==="true"?te.toWeb(te.from([Buffer.from("SOMETHING")])):te.toWeb(te.from([]))}var O=y(()=>{});function me(e){return le(e.entries())}var he=y(()=>{B()});var Ye=Lt(ae=>{"use strict";Object.defineProperty(ae,"__esModule",{value:!0});ae.parse=Sr;ae.serialize=Pr;var Rr=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,Er=/^[\u0021-\u003A\u003C-\u007E]*$/,_r=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,br=/^[\u0020-\u003A\u003D-\u007E]*$/,vr=Object.prototype.toString,Cr=(()=>{let e=function(){};return e.prototype=Object.create(null),e})();function Sr(e,t){let r=new Cr,o=e.length;if(o<2)return r;let a=t?.decode||Nr,n=0;do{let s=e.indexOf("=",n);if(s===-1)break;let i=e.indexOf(";",n),l=i===-1?o:i;if(s>l){n=e.lastIndexOf(";",s-1)+1;continue}let f=Je(e,n,s),d=Ke(e,s,f),c=e.slice(f,d);if(r[c]===void 0){let p=Je(e,s+1,l),g=Ke(e,l,p),h=a(e.slice(p,g));r[c]=h}n=l+1}while(n<o);return r}function Je(e,t,r){do{let o=e.charCodeAt(t);if(o!==32&&o!==9)return t}while(++t<r);return r}function Ke(e,t,r){for(;t>r;){let o=e.charCodeAt(--t);if(o!==32&&o!==9)return t+1}return r}function Pr(e,t,r){let o=r?.encode||encodeURIComponent;if(!Rr.test(e))throw new TypeError(`argument name is invalid: ${e}`);let a=o(t);if(!Er.test(a))throw new TypeError(`argument val is invalid: ${t}`);let n=e+"="+a;if(!r)return n;if(r.maxAge!==void 0){if(!Number.isInteger(r.maxAge))throw new TypeError(`option maxAge is invalid: ${r.maxAge}`);n+="; Max-Age="+r.maxAge}if(r.domain){if(!_r.test(r.domain))throw new TypeError(`option domain is invalid: ${r.domain}`);n+="; Domain="+r.domain}if(r.path){if(!br.test(r.path))throw new TypeError(`option path is invalid: ${r.path}`);n+="; Path="+r.path}if(r.expires){if(!Tr(r.expires)||!Number.isFinite(r.expires.valueOf()))throw new TypeError(`option expires is invalid: ${r.expires}`);n+="; Expires="+r.expires.toUTCString()}if(r.httpOnly&&(n+="; HttpOnly"),r.secure&&(n+="; Secure"),r.partitioned&&(n+="; Partitioned"),r.priority)switch(typeof r.priority=="string"?r.priority.toLowerCase():void 0){case"low":n+="; Priority=Low";break;case"medium":n+="; Priority=Medium";break;case"high":n+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${r.priority}`)}if(r.sameSite)switch(typeof r.sameSite=="string"?r.sameSite.toLowerCase():r.sameSite){case!0:case"strict":n+="; SameSite=Strict";break;case"lax":n+="; SameSite=Lax";break;case"none":n+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${r.sameSite}`)}return n}function Nr(e){if(e.indexOf("%")===-1)return e;try{return decodeURIComponent(e)}catch{return e}}function Tr(e){return vr.call(e)==="[object Date]"}});var et={};C(et,{default:()=>Hr});import{Buffer as Ar}from"node:buffer";var Ze,Lr,kr,Hr,tt=y(()=>{Ze=Ht(Ye(),1);B();he();Lr=new Set([101,103,204,205,304]),kr={convertFrom:async e=>{let t=new URL(e.url),r=t.searchParams,o=me(r),a=await e.arrayBuffer(),n={};e.headers.forEach((c,p)=>{n[p]=c});let s=t.pathname,i=e.method,l=i!=="GET"&&i!=="HEAD",f=e.headers.get("cookie"),d=f?Ze.default.parse(f):{};return{type:"core",method:i,rawPath:s,url:e.url,body:l?Ar.from(a):void 0,headers:n,remoteAddress:e.headers.get("x-forwarded-for")??"::1",query:o,cookies:d}},convertTo:async e=>{if("internalEvent"in e){let o=new Request(e.internalEvent.url,{body:e.internalEvent.body,method:e.internalEvent.method,headers:{...e.internalEvent.headers,"x-forwarded-host":e.internalEvent.headers.host}});if(globalThis.__dangerous_ON_edge_converter_returns_request===!0)return o;let a=(e.isISR||e.internalEvent.rawPath.startsWith("/_next/image"))&&process.env.DISABLE_CACHE!=="true"?{cacheEverything:!0}:{};return fetch(o,{cf:a})}let t=new Headers;for(let[o,a]of Object.entries(e.headers)){if(o==="set-cookie"&&typeof a=="string"){let n=Y(a);for(let s of n)t.append(o,s);continue}if(Array.isArray(a))for(let n of a)t.append(o,n);else t.set(o,a)}let r=Lr.has(e.statusCode)?null:e.body;return new Response(r,{status:e.statusCode,headers:t})},name:"edge"},Hr=kr});var rt={};C(rt,{default:()=>jr});import{Writable as Mr}from"node:stream";var Ir,Or,jr,ot=y(()=>{Ir=new Set([101,204,205,304]),Or=async(e,t)=>async(r,o,a)=>{globalThis.process=process;for(let[d,c]of Object.entries(o))typeof c=="string"&&(process.env[d]=c);let n=await t.convertFrom(r),s=new URL(r.url),{promise:i,resolve:l}=Promise.withResolvers(),f={writeHeaders(d){let{statusCode:c,cookies:p,headers:g}=d,h=new Headers(g);for(let H of p)h.append("Set-Cookie",H);s.hostname==="localhost"&&h.set("Content-Encoding","identity");let{readable:U,writable:P}=new TransformStream({transform(H,ne){ne.enqueue(Uint8Array.from(H.chunk??H))}}),k=Ir.has(c)?null:U,_=new Response(k,{status:c,headers:h});return l(_),Mr.fromWeb(P)}};return a.waitUntil(e(n,{streamCreator:f,waitUntil:a.waitUntil.bind(a)})),i},jr={wrapper:Or,name:"cloudflare-node",supportStreaming:!0}});var at={};C(at,{default:()=>Ur});var Dr,Ur,nt=y(()=>{Dr={name:"dummy",mode:"original",getByPath:async()=>[],getByTag:async()=>[],getLastModified:async(e,t)=>t??Date.now(),writeTags:async()=>{}},Ur=Dr});var st={};C(st,{default:()=>qr});var $r,qr,it=y(()=>{J();$r={name:"dummy",send:async()=>{throw new V("Dummy queue is not implemented")}},qr=$r});var ct={};C(ct,{default:()=>Br});var Fr,Br,lt=y(()=>{J();Fr={name:"dummy",get:async()=>{throw new M('"Dummy" cache does not cache anything')},set:async()=>{throw new M('"Dummy" cache does not cache anything')},delete:async()=>{throw new M('"Dummy" cache does not cache anything')}},Br=Fr});var dt={};C(dt,{default:()=>zr});var Wr,zr,ut=y(()=>{Wr={name:"dummy"},zr=Wr});var pt={};C(pt,{default:()=>Xr});var Qr,Xr,ft=y(()=>{O();Qr={name:"fetch-proxy",proxy:async e=>{let{url:t,headers:r,method:o,body:a}=e,n=Object.fromEntries(Object.entries(r).filter(([l])=>l.toLowerCase()!=="cf-connecting-ip")),s=await fetch(t,{method:o,headers:n,body:a}),i={};return s.headers.forEach((l,f)=>{i[f]=l}),{type:"core",headers:i,statusCode:s.status,isBase64Encoded:!0,body:s.body??I()}}},Xr=Qr});var mt={};C(mt,{default:()=>Gr});var Gr,ht=y(()=>{Gr={name:"dummy",invalidatePaths:e=>Promise.resolve()}});w();import Se from"node:path";import S from"node:fs";import T from"node:path";function ye(e){let t=T.join(e,"required-server-files.json"),r=S.readFileSync(t,"utf-8"),{config:o}=JSON.parse(r);return o}function Re(e){let t=T.join(e,"BUILD_ID");return S.readFileSync(t,"utf-8").trim()}function ie(e){let t=T.join(e,"server/pages-manifest.json"),r=S.readFileSync(t,"utf-8");return JSON.parse(r)}function Ee(e){return Object.entries(ie(e)).filter(([t,r])=>r.endsWith(".html")).map(([t])=>t)}function _e(e){let t=T.join(e,"routes-manifest.json"),r=S.readFileSync(t,"utf-8"),o=JSON.parse(r),a=o.dataRoutes??[],n={static:a.filter(s=>s.routeKeys===void 0),dynamic:a.filter(s=>s.routeKeys!==void 0)};return{basePath:o.basePath,rewrites:Array.isArray(o.rewrites)?{beforeFiles:[],afterFiles:o.rewrites,fallback:[]}:{beforeFiles:o.rewrites.beforeFiles??[],afterFiles:o.rewrites.afterFiles??[],fallback:o.rewrites.fallback??[]},redirects:o.redirects??[],routes:{static:o.staticRoutes??[],dynamic:o.dynamicRoutes??[],data:n},locales:o.i18n?.locales??[]}}function be(e){let t=T.join(e,"app-path-routes-manifest.json");return S.existsSync(t)?JSON.parse(S.readFileSync(t,"utf-8")):{}}function ve(e){let t=T.join(e,"server/middleware-manifest.json"),r=S.readFileSync(t,"utf-8");return JSON.parse(r)}function Ce(e){let t=T.join(e,"server/functions-config-manifest.json");try{let r=S.readFileSync(t,"utf-8");return JSON.parse(r)}catch{return{functions:{},version:1}}}var b=Se.join(__dirname,".next"),Dt=Se.join(__dirname,".open-next");u({NEXT_DIR:b,OPEN_NEXT_DIR:Dt});var m=ye(b),F=Re(b),Pe=Ee(b),v=_e(b);var Ne=ie(b);var Te=ve(b);var ce=be(b),Ae=Ce(b);w();function Le(){let e=process.env;e.NODE_ENV=process.env.NODE_ENV??"production"}function ke(){return Math.random().toString(36).slice(2,8)}import{AsyncLocalStorage as wr}from"node:async_hooks";w();B();import{Transform as $t}from"node:stream";var A="set-cookie",L="This cannot be used in OpenNext",Z=class extends $t{fixHeaders;onEnd;streamCreator;initialHeaders;statusCode;statusMessage="";headers={};_cookies=[];responseStream;headersSent=!1;_chunks=[];strictContentLength=!1;assignSocket(t){throw new Error(L)}detachSocket(t){throw new Error(L)}writeContinue(t){throw new Error(L)}writeEarlyHints(t,r){throw new Error(L)}writeProcessing(){throw new Error(L)}req;chunkedEncoding=!1;shouldKeepAlive=!0;useChunkedEncodingByDefault=!0;sendDate=!1;connection=null;socket=null;setTimeout(t,r){throw new Error(L)}addTrailers(t){throw new Error(L)}constructor(t,r,o,a,n){super(),this.fixHeaders=t,this.onEnd=r,this.streamCreator=o,this.initialHeaders=a,n&&Number.isInteger(n)&&n>=100&&n<=599&&(this.statusCode=n)}get originalResponse(){return this}get finished(){return this.responseStream?this.responseStream?.writableFinished:this.writableFinished}setHeader(t,r){let o=t.toLowerCase();return o===A&&(Array.isArray(r)?this._cookies=r:this._cookies=[r]),this.headers[o]=r,this}removeHeader(t){let r=t.toLowerCase();return r===A?this._cookies=[]:delete this.headers[r],this}hasHeader(t){let r=t.toLowerCase();return r===A?this._cookies.length>0:this.headers[r]!==void 0}getHeaders(){return this.headers}getHeader(t){return this.headers[t.toLowerCase()]}getHeaderNames(){return Object.keys(this.headers)}flushHeaders(){this.headersSent=!0;let t=globalThis.__openNextAls?.getStore()?.mergeHeadersPriority??"middleware";if(this.initialHeaders){this.headers=t==="middleware"?{...this.headers,...this.initialHeaders}:{...this.initialHeaders,...this.headers};let o=Y(this.initialHeaders[A]?.toString());this._cookies=t==="middleware"?[...this._cookies,...o]:[...o,...this._cookies]}this.fixHeaders(this.headers),this.fixHeadersForError(),this.headers[A]=this._cookies;let r=K(this.headers);delete r[A],this.streamCreator&&(this.responseStream=this.streamCreator?.writeHeaders({statusCode:this.statusCode??200,cookies:this._cookies,headers:r}),this.pipe(this.responseStream))}appendHeader(t,r){let o=t.toLowerCase();if(!this.hasHeader(o))return this.setHeader(o,r);let a=this.getHeader(o),n=Array.isArray(r)?r:[r],s=Array.isArray(a)?[...a,...n]:[a,...n];return this.setHeader(o,s)}writeHead(t,r,o){let a=o,n;typeof r=="string"?n=r:a=r;let s=this.headers;if(a)if(Array.isArray(a))for(let i=0;i<a.length;i+=2)s[a[i]]=a[i+1];else for(let i of Object.keys(a))s[i]=a[i];return this.statusCode=t,o&&(this.headers=s),this.flushHeaders(),this}getFixedHeaders(){return this.fixHeaders(this.headers),this.fixHeadersForError(),this.headers[A]=this._cookies,this.headers}getBody(){return Buffer.concat(this._chunks)}_internalWrite(t,r){this._chunks.push(Buffer.from(t,r)),this.push(t,r),this.streamCreator?.onWrite?.()}_transform(t,r,o){this.headersSent||this.flushHeaders(),this._internalWrite(t,r),o()}_flush(t){this.headersSent||this.flushHeaders(),globalThis.__openNextAls?.getStore()?.pendingPromiseRunner.add(this.onEnd(this.headers));let r=this.getBody().length;this.streamCreator?.onFinish?.(r),r===0&&process.env.OPEN_NEXT_FORCE_NON_EMPTY_RESPONSE==="true"&&(u('Force writing "SOMETHING" to the response body'),this.push("SOMETHING")),t()}setHeaders(t){return t.forEach((r,o)=>{this.setHeader(o,Array.isArray(r)?r:r.toString())}),this}get sent(){return this.finished||this.headersSent}getHeaderValues(t){let r=this.getHeader(t);if(r!==void 0)return(Array.isArray(r)?r:[r]).map(o=>o.toString())}send(){let t=this.getBody();this.end(t)}body(t){return this.write(t),this}onClose(t){this.on("close",t)}redirect(t,r){return this.setHeader("Location",t),this.statusCode=r,r===308&&this.setHeader("Refresh",`0;url=${t}`),this}fixHeadersForError(){process.env.OPEN_NEXT_DANGEROUSLY_SET_ERROR_HEADERS!=="true"&&(this.statusCode===404||this.statusCode===500)&&(this.headers["cache-control"]="private, no-cache, no-store, max-age=0, must-revalidate")}};import qt from"node:http";var W=class extends qt.IncomingMessage{constructor({method:t,url:r,headers:o,body:a,remoteAddress:n}){super({encrypted:!0,readable:!1,remoteAddress:n,address:()=>({port:443}),end:Function.prototype,destroy:Function.prototype}),a&&(o["content-length"]??=String(Buffer.byteLength(a))),Object.assign(this,{ip:n,complete:!0,httpVersion:"1.1",httpVersionMajor:"1",httpVersionMinor:"1",method:t,headers:o,body:a,url:r}),this._read=()=>{this.push(a),this.push(null)}}};w();var ee=class{resolve;reject;promise;constructor(){let t,r;this.promise=new Promise((o,a)=>{t=o,r=a}),this.resolve=t,this.reject=r}},de=class{promises=[];withResolvers(){let t=new ee;return this.promises.push(t),t}add(t){let r=new ee;this.promises.push(r),t.then(r.resolve,r.reject)}async await(){u(`Awaiting ${this.promises.length} detached promises`),(await Promise.allSettled(this.promises.map(o=>o.promise))).filter(o=>o.status==="rejected").forEach(o=>{R(o.reason)})}};async function Ft(){let e=globalThis.__openNextAls.getStore(),t=e?.pendingPromiseRunner.await()??Promise.resolve();if(e?.waitUntil){e.waitUntil(t);return}await t}function Bt(){let e=Symbol.for("@next/request-context"),t=Symbol.for("@vercel/request-context"),r=globalThis.__openNextAls.getStore(),o=r?.waitUntil??(n=>r?.pendingPromiseRunner.add(n)),a={get:()=>({waitUntil:o})};globalThis[e]=a,process.env.EMULATE_VERCEL_REQUEST_CONTEXT&&(globalThis[t]=a)}function He({isISRRevalidation:e,waitUntil:t,requestId:r=Math.random().toString(36)},o){return globalThis.__openNextAls.run({requestId:r,pendingPromiseRunner:new de,isISRRevalidation:e,waitUntil:t,writtenTags:new Set},async()=>{Bt();let a;try{a=await o()}finally{await Ft()}return a})}w();var Wt=N("node:module"),Po=Wt._resolveFilename;import Yt from"node:crypto";import{Readable as je}from"node:stream";B();w();var zt=new Set(["application/octet-stream","application/epub+zip","application/msword","application/pdf","application/rtf","application/vnd.amazon.ebook","application/vnd.ms-excel","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.openxmlformats-officedocument.wordprocessingml.document","font/otf","font/woff","font/woff2","image/bmp","image/gif","image/jpeg","image/png","image/tiff","image/vnd.microsoft.icon","image/webp","audio/3gpp","audio/aac","audio/basic","audio/flac","audio/mpeg","audio/ogg","audio/wavaudio/webm","audio/x-aiff","audio/x-midi","audio/x-wav","video/3gpp","video/mp2t","video/mpeg","video/ogg","video/quicktime","video/webm","video/x-msvideo","application/java-archive","application/vnd.apple.installer+xml","application/x-7z-compressed","application/x-apple-diskimage","application/x-bzip","application/x-bzip2","application/x-gzip","application/x-java-archive","application/x-rar-compressed","application/x-tar","application/x-zip","application/zip","application/x-protobuf"]);function Me(e){if(!e)return!1;let t=e?.split(";")[0]??"";return zt.has(t)}O();w();function Qt(e,t,r){let o=new Map,a=e.replace(/[ \t]/g,"");if(t){let d=0;for(let c of t){let p=c.toLowerCase();if(o.set(p,{orig:c,pos:d++}),r.prefixMatch){let g=p.split("-");for(;g.pop(),g.length>0;){let h=g.join("-");o.has(h)||o.set(h,{orig:c,pos:d++})}}}}let n=a.split(","),s=[],i=new Set;for(let d=0;d<n.length;++d){let c=n[d];if(!c)continue;let p=c.split(";");if(p.length>2)throw new Error(`Invalid ${r.type} header`);let g=p[0].toLowerCase();if(!g)throw new Error(`Invalid ${r.type} header`);let h={token:g,pos:d,q:1};if(t&&o.has(g)&&(h.pref=o.get(g).pos),i.add(h.token),p.length===2){let U=p[1],[P,k]=U.split("=");if(!k||P!=="q"&&P!=="Q")throw new Error(`Invalid ${r.type} header`);let _=Number.parseFloat(k);if(_===0)continue;Number.isFinite(_)&&_<=1&&_>=.001&&(h.q=_)}s.push(h)}s.sort((d,c)=>c.q!==d.q?c.q-d.q:c.pref!==d.pref?d.pref===void 0?1:c.pref===void 0?-1:d.pref-c.pref:d.pos-c.pos);let l=s.map(d=>d.token);if(!t||!t.length)return l;let f=[];for(let d of l)if(d==="*")for(let[c,p]of o)i.has(c)||f.push(p.orig);else{let c=d.toLowerCase();o.has(c)&&f.push(o.get(c).orig)}return f}function Ie(e="",t){return Qt(e,t,{type:"accept-language",prefixMatch:!0})[0]||void 0}function Xt(e){return m.i18n?.locales.includes(e.split("/")[1].toLowerCase())??!1}function Gt(e){let t=m.i18n,r=e.NEXT_LOCALE?.toLowerCase();return r?t?.locales.find(o=>r===o.toLowerCase()):void 0}function Vt({hostname:e,detectedLocale:t}){let o=m.i18n?.domains;if(!o)return;let a=t?.toLowerCase();for(let n of o){let s=n.domain.split(":",1)[0].toLowerCase();if(e===s||a===n.defaultLocale.toLowerCase()||n.locales?.some(i=>a===i.toLowerCase()))return n}}function Oe(e,t){let r=Vt({hostname:e.headers.host});if(t.localeDetection===!1)return r?.defaultLocale??t.defaultLocale;let o=Gt(e.cookies),a=Ie(e.headers["accept-language"],t?.locales);return u({cookiesLocale:o,preferredLocale:a,defaultLocale:t.defaultLocale,domainLocale:r}),r?.defaultLocale??o??a??t.defaultLocale}function z(e){let t=m.i18n;return!t||Xt(e.rawPath)?e.rawPath:`/${Oe(e,t)}${e.rawPath}`}function Jt(e,t,r){let o=Kt(e),a=o+=1831565813;a=Math.imul(a^a>>>15,a|1),a^=a+Math.imul(a^a>>>7,a|61);let n=((a^a>>>14)>>>0)/4294967296,s=Math.floor(n*t);return`${r}-${s}`}function ue(e){let t=Number.parseInt(process.env.MAX_REVALIDATE_CONCURRENCY??"10");return Jt(e,t,"revalidate")}function Kt(e){let t=1779033703,r=3144134277,o=1013904242,a=2773480762;for(let n=0,s;n<e.length;n++)s=e.charCodeAt(n),t=r^Math.imul(t^s,597399067),r=o^Math.imul(r^s,2869860233),o=a^Math.imul(o^s,951274213),a=t^Math.imul(a^s,2716044179);return t=Math.imul(o^t>>>18,597399067),r=Math.imul(a^r>>>22,2869860233),o=Math.imul(t^o>>>17,951274213),a=Math.imul(r^a>>>19,2716044179),t^=r^o^a,r^=t,o^=t,a^=t,t>>>0}function Q(e,t){let r=m.basePath??"";return new URL(`${r}${t}`,e).href}function De(e){let t=e.statusCode||200,r=K(e.getFixedHeaders()),o=Me(r["content-type"])||!!r["content-encoding"],a=je.toWeb(je.from(e.getBody()));return{type:"core",statusCode:t,headers:r,body:a,isBase64Encoded:o}}function pe(e){let t=[];return Object.entries(e).forEach(([r,o])=>{Array.isArray(o)?o.forEach(a=>t.push(`${r}=${a}`)):t.push(`${r}=${o}`)}),t.length>0?`?${t.join("&")}`:""}function Ue(e){let t=new URLSearchParams(e),r={};for(let o of t.keys()){let a=t.getAll(o);r[o]=a.length>1?a:a[0]}return r}function $e(e,t){if(t?.functions?.["/_middleware"])return t.functions["/_middleware"].matchers?.map(({regexp:o})=>new RegExp(o))??[/.*/];let r=e.middleware["/"];return r?.matchers?r.matchers.map(({regexp:o})=>new RegExp(o)):[]}var x;(function(e){e.CACHE_CONTROL="cache-control",e.NEXT_CACHE="x-nextjs-cache"})(x||(x={}));function Zt(e,t){if(e.rawPath==="/404"||e.rawPath==="/500"){if(process.env.OPEN_NEXT_DANGEROUSLY_SET_ERROR_HEADERS==="true")return;t[x.CACHE_CONTROL]="private, no-cache, no-store, max-age=0, must-revalidate";return}let r=z(e);Pe.includes(r)&&!e.headers["x-middleware-prefetch"]&&(t[x.CACHE_CONTROL]="public, max-age=0, s-maxage=31536000, must-revalidate")}function er(e){let t=e[x.CACHE_CONTROL];t&&(Array.isArray(t)&&(t=t.join(",")),typeof t=="string"&&(e[x.CACHE_CONTROL]=t.replace(/\bstale-while-revalidate(?!=)/,"stale-while-revalidate=2592000")))}function tr(e){m.poweredByHeader&&(e["X-OpenNext"]="1"),globalThis.openNextDebug&&(e["X-OpenNext-Version"]=globalThis.openNextVersion),(process.env.OPEN_NEXT_REQUEST_ID_HEADER||globalThis.openNextDebug)&&(e["X-OpenNext-RequestId"]=globalThis.__openNextAls.getStore()?.requestId)}async function rr(e,t,r,o){if(r[x.NEXT_CACHE]==="STALE"){let a=o?.[Symbol.for("NextInternalRequestMeta")],n=a?._nextDidRewrite?t.startsWith("/_next/data/")?`/_next/data/${F}${a?._nextRewroteUrl}.json`:a?._nextRewroteUrl:t;try{let s=f=>Yt.createHash("md5").update(f).digest("hex"),i=globalThis.__openNextAls.getStore()?.lastModified??0,l=`${r.etag??r.ETag??""}`;await globalThis.queue.send({MessageBody:{host:e,url:n,eTag:l,lastModified:i},MessageDeduplicationId:s(`${t}-${i}-${l}`),MessageGroupId:ue(t)})}catch(s){R(`Failed to revalidate stale page ${t}`,s)}}}function or(e){if(e[x.NEXT_CACHE]==="REVALIDATED"){e[x.CACHE_CONTROL]="private, no-cache, no-store, max-age=0, must-revalidate";return}let t=globalThis.__openNextAls.getStore()?.lastModified??0;if(e[x.NEXT_CACHE]==="HIT"&&t>0){let r=Math.round((Date.now()-t)/1e3),o=/s-maxage=(\d+)/,a=e[x.CACHE_CONTROL];if(u("cache-control",a,t,Date.now()),typeof a!="string")return;let n=a.match(o),s=n?Number.parseInt(n[1]):void 0;if(s&&s!==31536e3){let i=Math.max(s-r,1);e[x.CACHE_CONTROL]=`s-maxage=${i}, stale-while-revalidate=2592000`}}e[x.NEXT_CACHE]==="STALE"&&(e[x.CACHE_CONTROL]="s-maxage=2, stale-while-revalidate=2592000")}function fe(e,t,r){let o=e.internalEvent;return new Z(a=>{Zt(o,a),er(a),tr(a),or(a)},async a=>{await rr(o.headers.host,o.rawPath,a),await ar(e,a)},r,t,e.rewriteStatusCode)}async function ar(e,t){let{internalEvent:r,resolvedRoutes:o,initialURL:a}=e,n=new URL(a).pathname;!(r.headers["x-isr"]==="1")&&t[x.NEXT_CACHE]==="REVALIDATED"&&await globalThis.cdnInvalidationHandler.invalidatePaths([{initialPath:n,rawPath:r.rawPath,resolvedRoutes:o}])}w();O();w();w();var ia=60*60*24*365,ca=60*60*24*30;O();w();var sr=`^/(?:${v.locales.map(e=>`${e}/?`).join("|")})?`,ir=v.basePath?`^${v.basePath}/?`:"^/",cr=sr.replace("^/",ir);function Fe(e){let t=e.map(a=>({page:a.page,regexp:new RegExp(a.regex.replace("^/",cr))})),r=new Set,o=new Set;for(let[a,n]of Object.entries(ce))a.endsWith("page")?r.add(n):a.endsWith("route")&&o.add(n);return function(n){return t.filter(i=>i.regexp.test(n)).map(i=>{let l="page";return r.has(i.page)?l="app":o.has(i.page)&&(l="route"),{route:i.page,type:l}})}}var Be=Fe([...v.routes.static,...lr()]),We=Fe(v.routes.dynamic);function lr(){let e=a=>({page:a,regex:`^${a}(?:/)?$`}),t=new Set(v.routes.dynamic.map(({page:a})=>a)),r=Object.keys(Ne).filter(a=>a.startsWith("/api/")&&!t.has(a)).map(e),o=Object.values(ce).filter(a=>a.startsWith("/api/")||a==="/api"&&!t.has(a)).map(e);return[...r,...o]}O();he();var pr=Te,fr=Ae,Ia=$e(pr,fr);var xe="x-middleware-response-",ze=xe.length,X="x-opennext-",ge=`${X}initial-url`,Za=`${X}locale`,we=`${X}resolved-routes`,Qe=`${X}rewrite-status-code`,Xe=`${X}request-id`;w();import hr from"next/dist/server/next-server.js";w();var mr=N("node:module"),rn=mr._resolveFilename;var xr=N.resolve("./cache.cjs"),gr=N.resolve("./composable-cache.cjs"),D=new hr.default({conf:{...m,compress:!1,cacheHandler:xr,cacheMaxMemorySize:0,experimental:{...m.experimental,trustHostHeader:!0,cacheHandlers:{default:gr}}},customServer:!1,dev:!1,dir:__dirname}),j=!1;globalThis.__next_route_preloader=async e=>{if(j)return;let r=(globalThis.fnName?globalThis.openNextConfig.functions[globalThis.fnName]:globalThis.openNextConfig.default)?.routePreloadingBehavior??"none";if(r==="none"){j=!0;return}if(!("unstable_preloadEntries"in D)){u("The current version of Next.js does not support route preloading. Skipping route preloading."),j=!0;return}if(e==="waitUntil"&&r==="withWaitUntil"){let o=globalThis.__openNextAls.getStore()?.waitUntil;if(!o){R("You've tried to use the 'withWaitUntil' route preloading behavior, but the 'waitUntil' function is not available."),j=!0;return}u("Preloading entries with waitUntil"),o?.(D.unstable_preloadEntries()),j=!0}else if(e==="start"&&r==="onStart"||e==="warmerEvent"&&r==="onWarmerEvent"||e==="onDemand"){let o=Date.now();u("Preloading entries"),await D.unstable_preloadEntries(),u("Preloading entries took",Date.now()-o,"ms"),j=!0}};var re=e=>"getRequestHandlerWithMetadata"in D?D.getRequestHandlerWithMetadata(e):D.getRequestHandler();globalThis.__openNextAls=new wr;async function Ge(e,t){let r=e.headers,o=globalThis.openNextConfig.middleware?.external?e.headers[Xe]:Math.random().toString(36);return He({isISRRevalidation:r["x-isr"]==="1",waitUntil:t?.waitUntil,requestId:o},async()=>{await globalThis.__next_route_preloader("waitUntil"),r["x-forwarded-host"]&&(r.host=r["x-forwarded-host"]),u("internalEvent",e);let a={initialPath:r[ge]??e.rawPath,resolvedRoutes:r[we]?JSON.parse(r[we]):[],rewriteStatusCode:Number.parseInt(r[Qe])},n={internalEvent:e,isExternalRewrite:!1,origin:!1,isISR:!1,initialURL:e.url,...a},s="type"in n?n.headers:n.internalEvent.headers,i={};for(let[E,G]of Object.entries(s)){if(!E.startsWith(xe))continue;let $=E.slice(ze);$!=="x-middleware-set-cookie"&&(i[$]=G),s[$]=G,delete s[E]}if("isExternalRewrite"in n&&n.isExternalRewrite===!0)try{n=await globalThis.proxyExternalRequest.proxy(n.internalEvent)}catch(E){R("External request failed.",E),n={internalEvent:{type:"core",rawPath:"/500",method:"GET",headers:{},url:Q(e.url,"/500"),query:{},cookies:{},remoteAddress:""},isExternalRewrite:!1,isISR:!1,origin:!1,initialURL:e.url,resolvedRoutes:[{route:"/500",type:"page"}]}}if("type"in n){if(t?.streamCreator){let E=fe({internalEvent:e,isExternalRewrite:!1,isISR:!1,resolvedRoutes:[],origin:!1,initialURL:e.url},n.headers,t.streamCreator);E.statusCode=n.statusCode,E.flushHeaders();let[G,$]=n.body.tee();for await(let Ct of G)E.write(Ct);E.end(),n.body=$}return n}let l=n.internalEvent;u("preprocessedEvent",l);let{search:f,pathname:d,hash:c}=new URL(l.url),p={method:l.method,url:`${d}${f}${c}`,headers:{...s},body:l.body,remoteAddress:l.remoteAddress},g=globalThis.openNextConfig.dangerous?.headersAndCookiesPriority?globalThis.openNextConfig.dangerous.headersAndCookiesPriority(l):"middleware",h=globalThis.__openNextAls.getStore();h&&(h.mergeHeadersPriority=g);let U=new W(p),P=fe(n,i,t?.streamCreator);await yr(U,P,n);let{statusCode:k,headers:_,isBase64Encoded:H,body:ne}=De(P);return{type:e.type,statusCode:k,headers:_,body:ne,isBase64Encoded:H}})}async function yr(e,t,r){delete e.body;let o=new URL(r.internalEvent.headers[ge]??r.initialURL),a;r.internalEvent.rawPath==="/500"?a=500:r.internalEvent.rawPath==="/404"&&(a=404);let n={isNextDataReq:r.internalEvent.query.__nextDataReq==="1",initURL:r.initialURL,initQuery:Ue(o.search),initProtocol:o.protocol,defaultLocale:m.i18n?.defaultLocale,locale:r.locale,middlewareInvoke:!1,invokePath:r.internalEvent.rawPath,invokeQuery:r.internalEvent.query,invokeStatus:a};try{e.url=o.pathname+pe(r.internalEvent.query),await re(n)(e,t)}catch(s){s.constructor.name==="NoFallbackError"?await Ve(e,t,r,n):(R("NextJS request failed.",s),await oe("500",t,r.internalEvent))}}async function Ve(e,t,r,o,a=1){if(a>=5){await oe("500",t,r.internalEvent);return}if(a>=r.resolvedRoutes.length){await oe("404",t,r.internalEvent);return}try{await re({...r,invokeOutput:r.resolvedRoutes[a].route,...o})(e,t)}catch(n){n.constructor.name==="NoFallbackError"?await Ve(e,t,r,o,a+1):(R("NextJS request failed.",n),await oe("500",t,r.internalEvent))}}async function oe(e,t,r){try{let o=new W({method:"GET",url:`/${e}`,headers:r.headers,body:r.body,remoteAddress:r.remoteAddress});await re({invokePath:e==="404"?"/404":"/500",invokeStatus:e==="404"?404:500,middlewareInvoke:!1})(o,t)}catch(o){R("NextJS request failed.",o),t.statusCode=500,t.setHeader("Content-Type","application/json"),t.end(JSON.stringify({message:"Server failed to respond.",details:o},null,2))}}async function xt(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(tt(),et))).default}async function gt(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(ot(),rt))).default}async function wt(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(nt(),at))).default}async function yt(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(it(),st))).default}async function Rt(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(lt(),ct))).default}async function Et(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(ut(),dt))).default}async function _t(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(ft(),pt))).default}async function bt(e){return typeof e=="function"?e():(await Promise.resolve().then(()=>(ht(),mt))).default}async function vt(){let e=await import("./open-next.config.mjs").then(n=>n.default),t=globalThis.fnName?e.functions[globalThis.fnName]:e.default;globalThis.serverId=ke(),globalThis.openNextConfig=e,await globalThis.__next_route_preloader("start"),globalThis.queue=await yt(t.override?.queue),globalThis.incrementalCache=await Rt(t.override?.incrementalCache),globalThis.tagCache=await wt(t.override?.tagCache),e.middleware?.external!==!0&&(globalThis.assetResolver=await Et(globalThis.openNextConfig.middleware?.assetResolver)),globalThis.proxyExternalRequest=await _t(t.override?.proxyExternalRequest),globalThis.cdnInvalidationHandler=await bt(t.override?.cdnInvalidation);let r=await xt(t.override?.converter),{wrapper:o,name:a}=await gt(t.override?.wrapper);return u("Using wrapper",a),o(Ge,r)}Le();Jr();Vr();globalThis.internalFetch=fetch;var zn=await vt();function Vr(){process.chdir(__dirname)}function Jr(){process.env.NEXT_BUILD_ID=F}export{zn as handler};
