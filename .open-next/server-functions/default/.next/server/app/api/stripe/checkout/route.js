(()=>{var a={};a.id=68,a.ids=[68],a.modules={3295:a=>{"use strict";a.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},7629:(a,b,c)=>{"use strict";c.d(b,{Rk:()=>m,dX:()=>k,wK:()=>n,wz:()=>j,yg:()=>l});var d=c(94634),e=c(16048),f=c(49695),g=c(80362),h=c(44999),i=c(50613);async function j(){let a=(await (0,h.UL)()).get("session");if(!a||!a.value)return null;let b=await (0,i.nr)(a.value);if(!b||!b.user||"number"!=typeof b.user.id||new Date(b.expires)<new Date)return null;let c=await f.db.select().from(g.users).where((0,d.Uo)((0,d.eq)(g.users.id,b.user.id),(0,d.kZ)(g.users.deletedAt))).limit(1);return 0===c.length?null:c[0]}async function k(a){let b=await f.db.select().from(g.teams).where((0,d.eq)(g.teams.stripeCustomerId,a)).limit(1);return b.length>0?b[0]:null}async function l(a,b){await f.db.update(g.teams).set({...b,updatedAt:new Date}).where((0,d.eq)(g.teams.id,a))}async function m(){let a=await j();if(!a)throw Error("User not authenticated");return await f.db.select({id:g.activityLogs.id,action:g.activityLogs.action,timestamp:g.activityLogs.timestamp,ipAddress:g.activityLogs.ipAddress,userName:g.users.name}).from(g.activityLogs).leftJoin(g.users,(0,d.eq)(g.activityLogs.userId,g.users.id)).where((0,d.eq)(g.activityLogs.userId,a.id)).orderBy((0,e.i)(g.activityLogs.timestamp)).limit(10)}async function n(){let a=await j();if(!a)return null;let b=await f.db.query.teamMembers.findFirst({where:(0,d.eq)(g.teamMembers.userId,a.id),with:{team:{with:{teamMembers:{with:{user:{columns:{id:!0,name:!0,email:!0}}}}}}}});return b?.team||null}},8704:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),!function(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(b,{HTTPAccessErrorStatus:function(){return c},HTTP_ERROR_FALLBACK_ERROR_CODE:function(){return e},getAccessFallbackErrorTypeByStatus:function(){return h},getAccessFallbackHTTPStatus:function(){return g},isHTTPAccessFallbackError:function(){return f}});let c={NOT_FOUND:404,FORBIDDEN:403,UNAUTHORIZED:401},d=new Set(Object.values(c)),e="NEXT_HTTP_ERROR_FALLBACK";function f(a){if("object"!=typeof a||null===a||!("digest"in a)||"string"!=typeof a.digest)return!1;let[b,c]=a.digest.split(";");return b===e&&d.has(Number(c))}function g(a){return Number(a.digest.split(";")[1])}function h(a){switch(a){case 401:return"unauthorized";case 403:return"forbidden";case 404:return"not-found";default:return}}("function"==typeof b.default||"object"==typeof b.default&&null!==b.default)&&void 0===b.default.__esModule&&(Object.defineProperty(b.default,"__esModule",{value:!0}),Object.assign(b.default,b),a.exports=b.default)},17967:(a,b,c)=>{"use strict";c.d(b,{Ow:()=>k,_4:()=>g,_B:()=>l,du:()=>i,fw:()=>h,sg:()=>j});var d=c(97877),e=c(39916),f=c(7629);let g=new d.A(process.env.STRIPE_SECRET_KEY,{apiVersion:"2025-07-30.basil"});async function h({team:a,priceId:b}){let c=await (0,f.wz)();a&&c||(0,e.redirect)(`/sign-up?redirect=checkout&priceId=${b}`);let d=await g.checkout.sessions.create({payment_method_types:["card"],line_items:[{price:b,quantity:1}],mode:"subscription",success_url:`${process.env.BASE_URL}/api/stripe/checkout?session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${process.env.BASE_URL}/pricing`,customer:a.stripeCustomerId||void 0,client_reference_id:c.id.toString(),allow_promotion_codes:!0,subscription_data:{trial_period_days:14}});(0,e.redirect)(d.url)}async function i(a){let b;a.stripeCustomerId&&a.stripeProductId||(0,e.redirect)("/pricing");let c=await g.billingPortal.configurations.list();if(c.data.length>0)b=c.data[0];else{let c=await g.products.retrieve(a.stripeProductId);if(!c.active)throw Error("Team's product is not active in Stripe");let d=await g.prices.list({product:c.id,active:!0});if(0===d.data.length)throw Error("No active prices found for the team's product");b=await g.billingPortal.configurations.create({business_profile:{headline:"Manage your subscription"},features:{subscription_update:{enabled:!0,default_allowed_updates:["price","quantity","promotion_code"],proration_behavior:"create_prorations",products:[{product:c.id,prices:d.data.map(a=>a.id)}]},subscription_cancel:{enabled:!0,mode:"at_period_end",cancellation_reason:{enabled:!0,options:["too_expensive","missing_features","switched_service","unused","other"]}},payment_method_update:{enabled:!0}}})}return g.billingPortal.sessions.create({customer:a.stripeCustomerId,return_url:`${process.env.BASE_URL}/dashboard`,configuration:b.id})}async function j(a){let b=a.customer,c=a.id,d=a.status,e=await (0,f.dX)(b);if(!e)return void console.error("Team not found for Stripe customer:",b);if("active"===d||"trialing"===d){let b=a.items.data[0]?.plan;await (0,f.yg)(e.id,{stripeSubscriptionId:c,stripeProductId:b?.product,planName:(b?.product).name,subscriptionStatus:d})}else("canceled"===d||"unpaid"===d)&&await (0,f.yg)(e.id,{stripeSubscriptionId:null,stripeProductId:null,planName:null,subscriptionStatus:d})}async function k(){return(await g.prices.list({expand:["data.product"],active:!0,type:"recurring"})).data.map(a=>({id:a.id,productId:"string"==typeof a.product?a.product:a.product.id,unitAmount:a.unit_amount,currency:a.currency,interval:a.recurring?.interval,trialPeriodDays:a.recurring?.trial_period_days}))}async function l(){return(await g.products.list({active:!0,expand:["data.default_price"]})).data.map(a=>({id:a.id,name:a.name,description:a.description,defaultPriceId:"string"==typeof a.default_price?a.default_price:a.default_price?.id}))}},19121:a=>{"use strict";a.exports=require("next/dist/server/app-render/action-async-storage.external.js")},21820:a=>{"use strict";a.exports=require("os")},27910:a=>{"use strict";a.exports=require("stream")},28354:a=>{"use strict";a.exports=require("util")},29021:a=>{"use strict";a.exports=require("fs")},29294:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-async-storage.external.js")},29727:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-page-experimental.runtime.prod.js")},31162:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"isNextRouterError",{enumerable:!0,get:function(){return f}});let d=c(8704),e=c(49026);function f(a){return(0,e.isRedirectError)(a)||(0,d.isHTTPAccessFallbackError)(a)}("function"==typeof b.default||"object"==typeof b.default&&null!==b.default)&&void 0===b.default.__esModule&&(Object.defineProperty(b.default,"__esModule",{value:!0}),Object.assign(b.default,b),a.exports=b.default)},33873:a=>{"use strict";a.exports=require("path")},34631:a=>{"use strict";a.exports=require("tls")},35823:(a,b,c)=>{"use strict";c.r(b),c.d(b,{patchFetch:()=>s,routeModule:()=>o,serverHooks:()=>r,workAsyncStorage:()=>p,workUnitAsyncStorage:()=>q});var d={};c.r(d),c.d(d,{GET:()=>n});var e=c(96559),f=c(48088),g=c(37719),h=c(94634),i=c(49695),j=c(80362),k=c(50613),l=c(32190),m=c(17967);async function n(a){let b=a.nextUrl.searchParams.get("session_id");if(!b)return l.NextResponse.redirect(new URL("/pricing",a.url));try{let c=await m._4.checkout.sessions.retrieve(b,{expand:["customer","subscription"]});if(!c.customer||"string"==typeof c.customer)throw Error("Invalid customer data from Stripe.");let d=c.customer.id,e="string"==typeof c.subscription?c.subscription:c.subscription?.id;if(!e)throw Error("No subscription found for this session.");let f=await m._4.subscriptions.retrieve(e,{expand:["items.data.price.product"]}),g=f.items.data[0]?.price;if(!g)throw Error("No plan found for this subscription.");let n=g.product.id;if(!n)throw Error("No product ID found for this subscription.");let o=c.client_reference_id;if(!o)throw Error("No user ID found in session's client_reference_id.");let p=await i.db.select().from(j.users).where((0,h.eq)(j.users.id,Number(o))).limit(1);if(0===p.length)throw Error("User not found in database.");let q=await i.db.select({teamId:j.teamMembers.teamId}).from(j.teamMembers).where((0,h.eq)(j.teamMembers.userId,p[0].id)).limit(1);if(0===q.length)throw Error("User is not associated with any team.");return await i.db.update(j.teams).set({stripeCustomerId:d,stripeSubscriptionId:e,stripeProductId:n,planName:g.product.name,subscriptionStatus:f.status,updatedAt:new Date}).where((0,h.eq)(j.teams.id,q[0].teamId)),await (0,k.Nq)(p[0]),l.NextResponse.redirect(new URL("/dashboard",a.url))}catch(b){return console.error("Error handling successful checkout:",b),l.NextResponse.redirect(new URL("/error",a.url))}}let o=new e.AppRouteRouteModule({definition:{kind:f.RouteKind.APP_ROUTE,page:"/api/stripe/checkout/route",pathname:"/api/stripe/checkout",filename:"route",bundlePath:"app/api/stripe/checkout/route"},distDir:".next",projectDir:"",resolvedPagePath:"/Users/gomolemokgatitsoe/projects/founderfinder/app/api/stripe/checkout/route.ts",nextConfigOutput:"standalone",userland:d}),{workAsyncStorage:p,workUnitAsyncStorage:q,serverHooks:r}=o;function s(){return(0,g.patchFetch)({workAsyncStorage:p,workUnitAsyncStorage:q})}},46871:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/app-route-experimental.runtime.prod.js")},49026:(a,b,c)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),!function(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(b,{REDIRECT_ERROR_CODE:function(){return e},RedirectType:function(){return f},isRedirectError:function(){return g}});let d=c(52836),e="NEXT_REDIRECT";var f=function(a){return a.push="push",a.replace="replace",a}({});function g(a){if("object"!=typeof a||null===a||!("digest"in a)||"string"!=typeof a.digest)return!1;let b=a.digest.split(";"),[c,f]=b,g=b.slice(2,-2).join(";"),h=Number(b.at(-2));return c===e&&("replace"===f||"push"===f)&&"string"==typeof g&&!isNaN(h)&&h in d.RedirectStatusCode}("function"==typeof b.default||"object"==typeof b.default&&null!==b.default)&&void 0===b.default.__esModule&&(Object.defineProperty(b.default,"__esModule",{value:!0}),Object.assign(b.default,b),a.exports=b.default)},49695:(a,b,c)=>{"use strict";c.d(b,{db:()=>i});var d=c(65761),e=c(43971),f=c(80362),g=c(97329);if(c.n(g)().config(),!process.env.POSTGRES_URL)throw Error("POSTGRES_URL environment variable is not set");let h=(0,e.A)(process.env.POSTGRES_URL),i=(0,d.f)(h,{schema:f})},50613:(a,b,c)=>{"use strict";c.d(b,{Nq:()=>j,nr:()=>i}),c(85663);var d=c(87806),e=c(77412),f=c(44999);let g=new TextEncoder().encode(process.env.AUTH_SECRET);async function h(a){return await new d.P(a).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("1 day from now").sign(g)}async function i(a){let{payload:b}=await (0,e.V)(a,g,{algorithms:["HS256"]});return b}async function j(a){let b=new Date(Date.now()+864e5),c={user:{id:a.id},expires:b.toISOString()},d=await h(c);(await (0,f.UL)()).set("session",d,{expires:b,httpOnly:!0,secure:!0,sameSite:"lax"})}},51846:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),!function(a,b){for(var c in b)Object.defineProperty(a,c,{enumerable:!0,get:b[c]})}(b,{BailoutToCSRError:function(){return d},isBailoutToCSRError:function(){return e}});let c="BAILOUT_TO_CLIENT_SIDE_RENDERING";class d extends Error{constructor(a){super("Bail out to client-side rendering: "+a),this.reason=a,this.digest=c}}function e(a){return"object"==typeof a&&null!==a&&"digest"in a&&a.digest===c}},52637:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"isPostpone",{enumerable:!0,get:function(){return d}});let c=Symbol.for("react.postpone");function d(a){return"object"==typeof a&&null!==a&&a.$$typeof===c}},52836:(a,b)=>{"use strict";Object.defineProperty(b,"__esModule",{value:!0}),Object.defineProperty(b,"RedirectStatusCode",{enumerable:!0,get:function(){return c}});var c=function(a){return a[a.SeeOther=303]="SeeOther",a[a.TemporaryRedirect=307]="TemporaryRedirect",a[a.PermanentRedirect=308]="PermanentRedirect",a}({});("function"==typeof b.default||"object"==typeof b.default&&null!==b.default)&&void 0===b.default.__esModule&&(Object.defineProperty(b.default,"__esModule",{value:!0}),Object.assign(b.default,b),a.exports=b.default)},55511:a=>{"use strict";a.exports=require("crypto")},55591:a=>{"use strict";a.exports=require("https")},63033:a=>{"use strict";a.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},74998:a=>{"use strict";a.exports=require("perf_hooks")},78335:()=>{},79646:a=>{"use strict";a.exports=require("child_process")},80362:(a,b,c)=>{"use strict";c.r(b),c.d(b,{ActivityType:()=>u,activityLogs:()=>n,activityLogsRelations:()=>t,invitations:()=>o,invitationsRelations:()=>r,teamMembers:()=>m,teamMembersRelations:()=>s,teams:()=>l,teamsRelations:()=>p,users:()=>k,usersRelations:()=>q});var d=c(43402),e=c(50033),f=c(79252),g=c(29334),h=c(9253),i=c(63431),j=c(5614);let k=(0,d.cJ)("users",{id:(0,e.vX)("id").primaryKey(),name:(0,f.yf)("name",{length:100}),email:(0,f.yf)("email",{length:255}).notNull().unique(),passwordHash:(0,g.Qq)("password_hash").notNull(),role:(0,f.yf)("role",{length:20}).notNull().default("member"),createdAt:(0,h.vE)("created_at").notNull().defaultNow(),updatedAt:(0,h.vE)("updated_at").notNull().defaultNow(),deletedAt:(0,h.vE)("deleted_at")}),l=(0,d.cJ)("teams",{id:(0,e.vX)("id").primaryKey(),name:(0,f.yf)("name",{length:100}).notNull(),createdAt:(0,h.vE)("created_at").notNull().defaultNow(),updatedAt:(0,h.vE)("updated_at").notNull().defaultNow(),stripeCustomerId:(0,g.Qq)("stripe_customer_id").unique(),stripeSubscriptionId:(0,g.Qq)("stripe_subscription_id").unique(),stripeProductId:(0,g.Qq)("stripe_product_id"),planName:(0,f.yf)("plan_name",{length:50}),subscriptionStatus:(0,f.yf)("subscription_status",{length:20})}),m=(0,d.cJ)("team_members",{id:(0,e.vX)("id").primaryKey(),userId:(0,i.nd)("user_id").notNull().references(()=>k.id),teamId:(0,i.nd)("team_id").notNull().references(()=>l.id),role:(0,f.yf)("role",{length:50}).notNull(),joinedAt:(0,h.vE)("joined_at").notNull().defaultNow()}),n=(0,d.cJ)("activity_logs",{id:(0,e.vX)("id").primaryKey(),teamId:(0,i.nd)("team_id").notNull().references(()=>l.id),userId:(0,i.nd)("user_id").references(()=>k.id),action:(0,g.Qq)("action").notNull(),timestamp:(0,h.vE)("timestamp").notNull().defaultNow(),ipAddress:(0,f.yf)("ip_address",{length:45})}),o=(0,d.cJ)("invitations",{id:(0,e.vX)("id").primaryKey(),teamId:(0,i.nd)("team_id").notNull().references(()=>l.id),email:(0,f.yf)("email",{length:255}).notNull(),role:(0,f.yf)("role",{length:50}).notNull(),invitedBy:(0,i.nd)("invited_by").notNull().references(()=>k.id),invitedAt:(0,h.vE)("invited_at").notNull().defaultNow(),status:(0,f.yf)("status",{length:20}).notNull().default("pending")}),p=(0,j.K1)(l,({many:a})=>({teamMembers:a(m),activityLogs:a(n),invitations:a(o)})),q=(0,j.K1)(k,({many:a})=>({teamMembers:a(m),invitationsSent:a(o)})),r=(0,j.K1)(o,({one:a})=>({team:a(l,{fields:[o.teamId],references:[l.id]}),invitedBy:a(k,{fields:[o.invitedBy],references:[k.id]})})),s=(0,j.K1)(m,({one:a})=>({user:a(k,{fields:[m.userId],references:[k.id]}),team:a(l,{fields:[m.teamId],references:[l.id]})})),t=(0,j.K1)(n,({one:a})=>({team:a(l,{fields:[n.teamId],references:[l.id]}),user:a(k,{fields:[n.userId],references:[k.id]})}));var u=function(a){return a.SIGN_UP="SIGN_UP",a.SIGN_IN="SIGN_IN",a.SIGN_OUT="SIGN_OUT",a.UPDATE_PASSWORD="UPDATE_PASSWORD",a.DELETE_ACCOUNT="DELETE_ACCOUNT",a.UPDATE_ACCOUNT="UPDATE_ACCOUNT",a.CREATE_TEAM="CREATE_TEAM",a.REMOVE_TEAM_MEMBER="REMOVE_TEAM_MEMBER",a.INVITE_TEAM_MEMBER="INVITE_TEAM_MEMBER",a.ACCEPT_INVITATION="ACCEPT_INVITATION",a}({})},81630:a=>{"use strict";a.exports=require("http")},91645:a=>{"use strict";a.exports=require("net")},94735:a=>{"use strict";a.exports=require("events")},96487:()=>{}};var b=require("../../../../webpack-runtime.js");b.C(a);var c=a=>b(b.s=a),d=b.X(0,[243,117,520,580],()=>c(35823));module.exports=d})();