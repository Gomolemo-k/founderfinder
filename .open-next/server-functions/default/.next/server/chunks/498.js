exports.id=498,exports.ids=[498],exports.modules={2568:(a,b,c)=>{"use strict";c.d(b,{du:()=>i,fw:()=>h});var d=c(8835),e=c(90141),f=c(21074);let g=new d.A(process.env.STRIPE_SECRET_KEY,{apiVersion:"2025-07-30.basil"});async function h({team:a,priceId:b}){let c=await (0,f.wz)();a&&c||(0,e.redirect)(`/sign-up?redirect=checkout&priceId=${b}`);let d=await g.checkout.sessions.create({payment_method_types:["card"],line_items:[{price:b,quantity:1}],mode:"subscription",success_url:`${process.env.BASE_URL}/api/stripe/checkout?session_id={CHECKOUT_SESSION_ID}`,cancel_url:`${process.env.BASE_URL}/pricing`,customer:a.stripeCustomerId||void 0,client_reference_id:c.id.toString(),allow_promotion_codes:!0,subscription_data:{trial_period_days:14}});(0,e.redirect)(d.url)}async function i(a){let b;a.stripeCustomerId&&a.stripeProductId||(0,e.redirect)("/pricing");let c=await g.billingPortal.configurations.list();if(c.data.length>0)b=c.data[0];else{let c=await g.products.retrieve(a.stripeProductId);if(!c.active)throw Error("Team's product is not active in Stripe");let d=await g.prices.list({product:c.id,active:!0});if(0===d.data.length)throw Error("No active prices found for the team's product");b=await g.billingPortal.configurations.create({business_profile:{headline:"Manage your subscription"},features:{subscription_update:{enabled:!0,default_allowed_updates:["price","quantity","promotion_code"],proration_behavior:"create_prorations",products:[{product:c.id,prices:d.data.map(a=>a.id)}]},subscription_cancel:{enabled:!0,mode:"at_period_end",cancellation_reason:{enabled:!0,options:["too_expensive","missing_features","switched_service","unused","other"]}},payment_method_update:{enabled:!0}}})}return g.billingPortal.sessions.create({customer:a.stripeCustomerId,return_url:`${process.env.BASE_URL}/dashboard`,configuration:b.id})}},7593:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,86346,23)),Promise.resolve().then(c.t.bind(c,27924,23)),Promise.resolve().then(c.t.bind(c,35656,23)),Promise.resolve().then(c.t.bind(c,22451,23)),Promise.resolve().then(c.t.bind(c,40099,23)),Promise.resolve().then(c.t.bind(c,38243,23)),Promise.resolve().then(c.t.bind(c,28827,23)),Promise.resolve().then(c.t.bind(c,62763,23)),Promise.resolve().then(c.t.bind(c,97173,23))},7629:(a,b,c)=>{"use strict";c.d(b,{Rk:()=>m,dX:()=>k,wK:()=>n,wz:()=>j,yg:()=>l});var d=c(94634),e=c(16048),f=c(49695),g=c(80362),h=c(44999),i=c(50613);async function j(){let a=(await (0,h.UL)()).get("session");if(!a||!a.value)return null;let b=await (0,i.nr)(a.value);if(!b||!b.user||"number"!=typeof b.user.id||new Date(b.expires)<new Date)return null;let c=await f.db.select().from(g.users).where((0,d.Uo)((0,d.eq)(g.users.id,b.user.id),(0,d.kZ)(g.users.deletedAt))).limit(1);return 0===c.length?null:c[0]}async function k(a){let b=await f.db.select().from(g.teams).where((0,d.eq)(g.teams.stripeCustomerId,a)).limit(1);return b.length>0?b[0]:null}async function l(a,b){await f.db.update(g.teams).set({...b,updatedAt:new Date}).where((0,d.eq)(g.teams.id,a))}async function m(){let a=await j();if(!a)throw Error("User not authenticated");return await f.db.select({id:g.activityLogs.id,action:g.activityLogs.action,timestamp:g.activityLogs.timestamp,ipAddress:g.activityLogs.ipAddress,userName:g.users.name}).from(g.activityLogs).leftJoin(g.users,(0,d.eq)(g.activityLogs.userId,g.users.id)).where((0,d.eq)(g.activityLogs.userId,a.id)).orderBy((0,e.i)(g.activityLogs.timestamp)).limit(10)}async function n(){let a=await j();if(!a)return null;let b=await f.db.query.teamMembers.findFirst({where:(0,d.eq)(g.teamMembers.userId,a.id),with:{team:{with:{teamMembers:{with:{user:{columns:{id:!0,name:!0,email:!0}}}}}}}});return b?.team||null}},17321:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,16444,23)),Promise.resolve().then(c.t.bind(c,16042,23)),Promise.resolve().then(c.t.bind(c,88170,23)),Promise.resolve().then(c.t.bind(c,88665,23)),Promise.resolve().then(c.t.bind(c,49477,23)),Promise.resolve().then(c.t.bind(c,29345,23)),Promise.resolve().then(c.t.bind(c,12089,23)),Promise.resolve().then(c.t.bind(c,46577,23)),Promise.resolve().then(c.t.bind(c,31307,23))},21074:(a,b,c)=>{"use strict";c.d(b,{lk:()=>j,wK:()=>k,wz:()=>i});var d=c(18839),e=c(38584),f=c(82807),g=c(74208),h=c(82970);async function i(){let a=(await (0,g.UL)()).get("session");if(!a||!a.value)return null;let b=await (0,h.nr)(a.value);if(!b||!b.user||"number"!=typeof b.user.id||new Date(b.expires)<new Date)return null;let c=await e.db.select().from(f.users).where((0,d.Uo)((0,d.eq)(f.users.id,b.user.id),(0,d.kZ)(f.users.deletedAt))).limit(1);return 0===c.length?null:c[0]}async function j(a){return(await e.db.select({user:f.users,teamId:f.teamMembers.teamId}).from(f.users).leftJoin(f.teamMembers,(0,d.eq)(f.users.id,f.teamMembers.userId)).where((0,d.eq)(f.users.id,a)).limit(1))[0]}async function k(){let a=await i();if(!a)return null;let b=await e.db.query.teamMembers.findFirst({where:(0,d.eq)(f.teamMembers.userId,a.id),with:{team:{with:{teamMembers:{with:{user:{columns:{id:!0,name:!0,email:!0}}}}}}}});return b?.team||null}},24934:(a,b,c)=>{"use strict";c.d(b,{$:()=>i});var d=c(60687);c(43210);var e=c(8730),f=c(24224),g=c(96241);let h=(0,f.F)("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground shadow-xs hover:bg-primary/90",destructive:"bg-destructive text-white shadow-xs hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background shadow-xs hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground shadow-xs hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9"}},defaultVariants:{variant:"default",size:"default"}});function i({className:a,variant:b,size:c,asChild:f=!1,...i}){let j=f?e.DX:"button";return(0,d.jsx)(j,{"data-slot":"button",className:(0,g.cn)(h({variant:b,size:c,className:a})),...i})}},38584:(a,b,c)=>{"use strict";c.d(b,{db:()=>i});var d=c(12141),e=c(36737),f=c(82807),g=c(41942);if(c.n(g)().config(),!process.env.POSTGRES_URL)throw Error("POSTGRES_URL environment variable is not set");let h=(0,e.A)(process.env.POSTGRES_URL),i=(0,d.f)(h,{schema:f})},46055:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>e});var d=c(31658);let e=async a=>[{type:"image/x-icon",sizes:"16x16",url:(0,d.fillMetadataSegment)(".",await a.params,"favicon.ico")+""}]},49695:(a,b,c)=>{"use strict";c.d(b,{db:()=>i});var d=c(65761),e=c(43971),f=c(80362),g=c(97329);if(c.n(g)().config(),!process.env.POSTGRES_URL)throw Error("POSTGRES_URL environment variable is not set");let h=(0,e.A)(process.env.POSTGRES_URL),i=(0,d.f)(h,{schema:f})},50613:(a,b,c)=>{"use strict";c.d(b,{Nq:()=>j,nr:()=>i}),c(85663);var d=c(87806),e=c(77412),f=c(44999);let g=new TextEncoder().encode(process.env.AUTH_SECRET);async function h(a){return await new d.P(a).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("1 day from now").sign(g)}async function i(a){let{payload:b}=await (0,e.V)(a,g,{algorithms:["HS256"]});return b}async function j(a){let b=new Date(Date.now()+864e5),c={user:{id:a.id},expires:b.toISOString()},d=await h(c);(await (0,f.UL)()).set("session",d,{expires:b,httpOnly:!0,secure:!0,sameSite:"lax"})}},51726:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,85814,23))},58014:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>k,metadata:()=>i,viewport:()=>j});var d=c(37413);c(82704);var e=c(2786),f=c.n(e),g=c(7629),h=c(35445);let i={title:"Next.js SaaS Starter",description:"Get started quickly with Next.js, Postgres, and Stripe."},j={maximumScale:1};function k({children:a}){return(0,d.jsx)("html",{lang:"en",className:`bg-white dark:bg-gray-950 text-black dark:text-white ${f().className}`,children:(0,d.jsx)("body",{className:"min-h-[100dvh] bg-gray-50",children:(0,d.jsx)(h.S,{value:{fallback:{"/api/user":(0,g.wz)(),"/api/team":(0,g.wK)()}},children:a})})})}},60673:(a,b,c)=>{Promise.resolve().then(c.bind(c,35445))},65638:(a,b,c)=>{Promise.resolve().then(c.t.bind(c,4536,23))},80362:(a,b,c)=>{"use strict";c.r(b),c.d(b,{ActivityType:()=>u,activityLogs:()=>n,activityLogsRelations:()=>t,invitations:()=>o,invitationsRelations:()=>r,teamMembers:()=>m,teamMembersRelations:()=>s,teams:()=>l,teamsRelations:()=>p,users:()=>k,usersRelations:()=>q});var d=c(43402),e=c(50033),f=c(79252),g=c(29334),h=c(9253),i=c(63431),j=c(5614);let k=(0,d.cJ)("users",{id:(0,e.vX)("id").primaryKey(),name:(0,f.yf)("name",{length:100}),email:(0,f.yf)("email",{length:255}).notNull().unique(),passwordHash:(0,g.Qq)("password_hash").notNull(),role:(0,f.yf)("role",{length:20}).notNull().default("member"),createdAt:(0,h.vE)("created_at").notNull().defaultNow(),updatedAt:(0,h.vE)("updated_at").notNull().defaultNow(),deletedAt:(0,h.vE)("deleted_at")}),l=(0,d.cJ)("teams",{id:(0,e.vX)("id").primaryKey(),name:(0,f.yf)("name",{length:100}).notNull(),createdAt:(0,h.vE)("created_at").notNull().defaultNow(),updatedAt:(0,h.vE)("updated_at").notNull().defaultNow(),stripeCustomerId:(0,g.Qq)("stripe_customer_id").unique(),stripeSubscriptionId:(0,g.Qq)("stripe_subscription_id").unique(),stripeProductId:(0,g.Qq)("stripe_product_id"),planName:(0,f.yf)("plan_name",{length:50}),subscriptionStatus:(0,f.yf)("subscription_status",{length:20})}),m=(0,d.cJ)("team_members",{id:(0,e.vX)("id").primaryKey(),userId:(0,i.nd)("user_id").notNull().references(()=>k.id),teamId:(0,i.nd)("team_id").notNull().references(()=>l.id),role:(0,f.yf)("role",{length:50}).notNull(),joinedAt:(0,h.vE)("joined_at").notNull().defaultNow()}),n=(0,d.cJ)("activity_logs",{id:(0,e.vX)("id").primaryKey(),teamId:(0,i.nd)("team_id").notNull().references(()=>l.id),userId:(0,i.nd)("user_id").references(()=>k.id),action:(0,g.Qq)("action").notNull(),timestamp:(0,h.vE)("timestamp").notNull().defaultNow(),ipAddress:(0,f.yf)("ip_address",{length:45})}),o=(0,d.cJ)("invitations",{id:(0,e.vX)("id").primaryKey(),teamId:(0,i.nd)("team_id").notNull().references(()=>l.id),email:(0,f.yf)("email",{length:255}).notNull(),role:(0,f.yf)("role",{length:50}).notNull(),invitedBy:(0,i.nd)("invited_by").notNull().references(()=>k.id),invitedAt:(0,h.vE)("invited_at").notNull().defaultNow(),status:(0,f.yf)("status",{length:20}).notNull().default("pending")}),p=(0,j.K1)(l,({many:a})=>({teamMembers:a(m),activityLogs:a(n),invitations:a(o)})),q=(0,j.K1)(k,({many:a})=>({teamMembers:a(m),invitationsSent:a(o)})),r=(0,j.K1)(o,({one:a})=>({team:a(l,{fields:[o.teamId],references:[l.id]}),invitedBy:a(k,{fields:[o.invitedBy],references:[k.id]})})),s=(0,j.K1)(m,({one:a})=>({user:a(k,{fields:[m.userId],references:[k.id]}),team:a(l,{fields:[m.teamId],references:[l.id]})})),t=(0,j.K1)(n,({one:a})=>({team:a(l,{fields:[n.teamId],references:[l.id]}),user:a(k,{fields:[n.userId],references:[k.id]})}));var u=function(a){return a.SIGN_UP="SIGN_UP",a.SIGN_IN="SIGN_IN",a.SIGN_OUT="SIGN_OUT",a.UPDATE_PASSWORD="UPDATE_PASSWORD",a.DELETE_ACCOUNT="DELETE_ACCOUNT",a.UPDATE_ACCOUNT="UPDATE_ACCOUNT",a.CREATE_TEAM="CREATE_TEAM",a.REMOVE_TEAM_MEMBER="REMOVE_TEAM_MEMBER",a.INVITE_TEAM_MEMBER="INVITE_TEAM_MEMBER",a.ACCEPT_INVITATION="ACCEPT_INVITATION",a}({})},82366:(a,b,c)=>{"use strict";c.r(b),c.d(b,{default:()=>h});var d=c(37413),e=c(4536),f=c.n(e),g=c(73768);function h(){return(0,d.jsx)("div",{className:"flex items-center justify-center min-h-[100dvh]",children:(0,d.jsxs)("div",{className:"max-w-md space-y-8 p-4 text-center",children:[(0,d.jsx)("div",{className:"flex justify-center",children:(0,d.jsx)(g.A,{className:"size-12 text-orange-500"})}),(0,d.jsx)("h1",{className:"text-4xl font-bold text-gray-900 tracking-tight",children:"Page Not Found"}),(0,d.jsx)("p",{className:"text-base text-gray-500",children:"The page you are looking for might have been removed, had its name changed, or is temporarily unavailable."}),(0,d.jsx)(f(),{href:"/",className:"max-w-48 mx-auto flex justify-center py-2 px-4 border border-gray-300 rounded-full shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-orange-500",children:"Back to Home"})]})})}},82704:()=>{},82807:(a,b,c)=>{"use strict";c.r(b),c.d(b,{ActivityType:()=>u,activityLogs:()=>n,activityLogsRelations:()=>t,invitations:()=>o,invitationsRelations:()=>r,teamMembers:()=>m,teamMembersRelations:()=>s,teams:()=>l,teamsRelations:()=>p,users:()=>k,usersRelations:()=>q});var d=c(15946),e=c(46134),f=c(43621),g=c(60579),h=c(91850),i=c(75680),j=c(31962);let k=(0,d.cJ)("users",{id:(0,e.vX)("id").primaryKey(),name:(0,f.yf)("name",{length:100}),email:(0,f.yf)("email",{length:255}).notNull().unique(),passwordHash:(0,g.Qq)("password_hash").notNull(),role:(0,f.yf)("role",{length:20}).notNull().default("member"),createdAt:(0,h.vE)("created_at").notNull().defaultNow(),updatedAt:(0,h.vE)("updated_at").notNull().defaultNow(),deletedAt:(0,h.vE)("deleted_at")}),l=(0,d.cJ)("teams",{id:(0,e.vX)("id").primaryKey(),name:(0,f.yf)("name",{length:100}).notNull(),createdAt:(0,h.vE)("created_at").notNull().defaultNow(),updatedAt:(0,h.vE)("updated_at").notNull().defaultNow(),stripeCustomerId:(0,g.Qq)("stripe_customer_id").unique(),stripeSubscriptionId:(0,g.Qq)("stripe_subscription_id").unique(),stripeProductId:(0,g.Qq)("stripe_product_id"),planName:(0,f.yf)("plan_name",{length:50}),subscriptionStatus:(0,f.yf)("subscription_status",{length:20})}),m=(0,d.cJ)("team_members",{id:(0,e.vX)("id").primaryKey(),userId:(0,i.nd)("user_id").notNull().references(()=>k.id),teamId:(0,i.nd)("team_id").notNull().references(()=>l.id),role:(0,f.yf)("role",{length:50}).notNull(),joinedAt:(0,h.vE)("joined_at").notNull().defaultNow()}),n=(0,d.cJ)("activity_logs",{id:(0,e.vX)("id").primaryKey(),teamId:(0,i.nd)("team_id").notNull().references(()=>l.id),userId:(0,i.nd)("user_id").references(()=>k.id),action:(0,g.Qq)("action").notNull(),timestamp:(0,h.vE)("timestamp").notNull().defaultNow(),ipAddress:(0,f.yf)("ip_address",{length:45})}),o=(0,d.cJ)("invitations",{id:(0,e.vX)("id").primaryKey(),teamId:(0,i.nd)("team_id").notNull().references(()=>l.id),email:(0,f.yf)("email",{length:255}).notNull(),role:(0,f.yf)("role",{length:50}).notNull(),invitedBy:(0,i.nd)("invited_by").notNull().references(()=>k.id),invitedAt:(0,h.vE)("invited_at").notNull().defaultNow(),status:(0,f.yf)("status",{length:20}).notNull().default("pending")}),p=(0,j.K1)(l,({many:a})=>({teamMembers:a(m),activityLogs:a(n),invitations:a(o)})),q=(0,j.K1)(k,({many:a})=>({teamMembers:a(m),invitationsSent:a(o)})),r=(0,j.K1)(o,({one:a})=>({team:a(l,{fields:[o.teamId],references:[l.id]}),invitedBy:a(k,{fields:[o.invitedBy],references:[k.id]})})),s=(0,j.K1)(m,({one:a})=>({user:a(k,{fields:[m.userId],references:[k.id]}),team:a(l,{fields:[m.teamId],references:[l.id]})})),t=(0,j.K1)(n,({one:a})=>({team:a(l,{fields:[n.teamId],references:[l.id]}),user:a(k,{fields:[n.userId],references:[k.id]})}));var u=function(a){return a.SIGN_UP="SIGN_UP",a.SIGN_IN="SIGN_IN",a.SIGN_OUT="SIGN_OUT",a.UPDATE_PASSWORD="UPDATE_PASSWORD",a.DELETE_ACCOUNT="DELETE_ACCOUNT",a.UPDATE_ACCOUNT="UPDATE_ACCOUNT",a.CREATE_TEAM="CREATE_TEAM",a.REMOVE_TEAM_MEMBER="REMOVE_TEAM_MEMBER",a.INVITE_TEAM_MEMBER="INVITE_TEAM_MEMBER",a.ACCEPT_INVITATION="ACCEPT_INVITATION",a}({})},82970:(a,b,c)=>{"use strict";c.d(b,{CF:()=>j,Er:()=>i,Nq:()=>m,nr:()=>l});var d=c(34872),e=c(17387),f=c(76318),g=c(74208);let h=new TextEncoder().encode(process.env.AUTH_SECRET);async function i(a){return(0,d.tW)(a,10)}async function j(a,b){return(0,d.UD)(a,b)}async function k(a){return await new e.P(a).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("1 day from now").sign(h)}async function l(a){let{payload:b}=await (0,f.V)(a,h,{algorithms:["HS256"]});return b}async function m(a){let b=new Date(Date.now()+864e5),c={user:{id:a.id},expires:b.toISOString()},d=await k(c);(await (0,g.UL)()).set("session",d,{expires:b,httpOnly:!0,secure:!0,sameSite:"lax"})}},85139:(a,b,c)=>{"use strict";c.d(b,{CI:()=>v,Hh:()=>u,Jv:()=>s,f3:()=>x,i3:()=>D,lw:()=>z,pj:()=>F,z0:()=>B});var d=c(91199);c(42087);var e=c(65699),f=c(18839),g=c(80705),h=c(38584),i=c(82807),j=c(82970),k=c(90141),l=c(74208),m=c(2568),n=c(21074),o=c(92486),p=c(33331);async function q(a,b,c,d){null!=a&&await h.db.insert(i.activityLogs).values({teamId:a,userId:b,action:c,ipAddress:d||""})}let r=e.Ik({email:e.Yj().email().min(3).max(255),password:e.Yj().min(8).max(100)}),s=(0,o.jI)(r,async(a,b)=>{let{email:c,password:d}=a,e=await h.db.select({user:i.users,team:i.teams}).from(i.users).leftJoin(i.teamMembers,(0,f.eq)(i.users.id,i.teamMembers.userId)).leftJoin(i.teams,(0,f.eq)(i.teamMembers.teamId,i.teams.id)).where((0,f.eq)(i.users.email,c)).limit(1);if(0===e.length)return{error:"Invalid email or password. Please try again.",email:c,password:d};let{user:g,team:l}=e[0];if(!await (0,j.CF)(d,g.passwordHash))return{error:"Invalid email or password. Please try again.",email:c,password:d};if(await Promise.all([(0,j.Nq)(g),q(l?.id,g.id,i.ActivityType.SIGN_IN)]),"checkout"===b.get("redirect")){let a=b.get("priceId");return(0,m.fw)({team:l,priceId:a})}(0,k.redirect)("/dashboard")}),t=e.Ik({email:e.Yj().email(),password:e.Yj().min(8),inviteId:e.Yj().optional()}),u=(0,o.jI)(t,async(a,b)=>{let c,d,{email:e,password:g,inviteId:l}=a;if((await h.db.select().from(i.users).where((0,f.eq)(i.users.email,e)).limit(1)).length>0)return{error:"Failed to create user. Please try again.",email:e,password:g};let n=await (0,j.Er)(g),[o]=await h.db.insert(i.users).values({email:e,passwordHash:n,role:"owner"}).returning();if(!o)return{error:"Failed to create user. Please try again.",email:e,password:g};let p=null;if(l){let[a]=await h.db.select().from(i.invitations).where((0,f.Uo)((0,f.eq)(i.invitations.id,parseInt(l)),(0,f.eq)(i.invitations.email,e),(0,f.eq)(i.invitations.status,"pending"))).limit(1);if(!a)return{error:"Invalid or expired invitation.",email:e,password:g};c=a.teamId,d=a.role,await h.db.update(i.invitations).set({status:"accepted"}).where((0,f.eq)(i.invitations.id,a.id)),await q(c,o.id,i.ActivityType.ACCEPT_INVITATION),[p]=await h.db.select().from(i.teams).where((0,f.eq)(i.teams.id,c)).limit(1)}else{let a={name:`${e}'s Team`};if([p]=await h.db.insert(i.teams).values(a).returning(),!p)return{error:"Failed to create team. Please try again.",email:e,password:g};c=p.id,d="owner",await q(c,o.id,i.ActivityType.CREATE_TEAM)}let r={userId:o.id,teamId:c,role:d};if(await Promise.all([h.db.insert(i.teamMembers).values(r),q(c,o.id,i.ActivityType.SIGN_UP),(0,j.Nq)(o)]),"checkout"===b.get("redirect")){let a=b.get("priceId");return(0,m.fw)({team:p,priceId:a})}(0,k.redirect)("/dashboard")});async function v(){let a=await (0,n.wz)(),b=await (0,n.lk)(a.id);await q(b?.teamId,a.id,i.ActivityType.SIGN_OUT),(await (0,l.UL)()).delete("session")}let w=e.Ik({currentPassword:e.Yj().min(8).max(100),newPassword:e.Yj().min(8).max(100),confirmPassword:e.Yj().min(8).max(100)}),x=(0,o.UX)(w,async(a,b,c)=>{let{currentPassword:d,newPassword:e,confirmPassword:g}=a;if(!await (0,j.CF)(d,c.passwordHash))return{currentPassword:d,newPassword:e,confirmPassword:g,error:"Current password is incorrect."};if(d===e)return{currentPassword:d,newPassword:e,confirmPassword:g,error:"New password must be different from the current password."};if(g!==e)return{currentPassword:d,newPassword:e,confirmPassword:g,error:"New password and confirmation password do not match."};let k=await (0,j.Er)(e),l=await (0,n.lk)(c.id);return await Promise.all([h.db.update(i.users).set({passwordHash:k}).where((0,f.eq)(i.users.id,c.id)),q(l?.teamId,c.id,i.ActivityType.UPDATE_PASSWORD)]),{success:"Password updated successfully."}}),y=e.Ik({password:e.Yj().min(8).max(100)}),z=(0,o.UX)(y,async(a,b,c)=>{let{password:d}=a;if(!await (0,j.CF)(d,c.passwordHash))return{password:d,error:"Incorrect password. Account deletion failed."};let e=await (0,n.lk)(c.id);await q(e?.teamId,c.id,i.ActivityType.DELETE_ACCOUNT),await h.db.update(i.users).set({deletedAt:(0,g.ll)`CURRENT_TIMESTAMP`,email:(0,g.ll)`CONCAT(email, '-', id, '-deleted')`}).where((0,f.eq)(i.users.id,c.id)),e?.teamId&&await h.db.delete(i.teamMembers).where((0,f.Uo)((0,f.eq)(i.teamMembers.userId,c.id),(0,f.eq)(i.teamMembers.teamId,e.teamId))),(await (0,l.UL)()).delete("session"),(0,k.redirect)("/sign-in")}),A=e.Ik({name:e.Yj().min(1,"Name is required").max(100),email:e.Yj().email("Invalid email address")}),B=(0,o.UX)(A,async(a,b,c)=>{let{name:d,email:e}=a,g=await (0,n.lk)(c.id);return await Promise.all([h.db.update(i.users).set({name:d,email:e}).where((0,f.eq)(i.users.id,c.id)),q(g?.teamId,c.id,i.ActivityType.UPDATE_ACCOUNT)]),{name:d,success:"Account updated successfully."}}),C=e.Ik({memberId:e.ai()}),D=(0,o.UX)(C,async(a,b,c)=>{let{memberId:d}=a,e=await (0,n.lk)(c.id);return e?.teamId?(await h.db.delete(i.teamMembers).where((0,f.Uo)((0,f.eq)(i.teamMembers.id,d),(0,f.eq)(i.teamMembers.teamId,e.teamId))),await q(e.teamId,c.id,i.ActivityType.REMOVE_TEAM_MEMBER),{success:"Team member removed successfully"}):{error:"User is not part of a team"}}),E=e.Ik({email:e.Yj().email("Invalid email address"),role:e.k5(["member","owner"])}),F=(0,o.UX)(E,async(a,b,c)=>{let{email:d,role:e}=a,g=await (0,n.lk)(c.id);return g?.teamId?(await h.db.select().from(i.users).leftJoin(i.teamMembers,(0,f.eq)(i.users.id,i.teamMembers.userId)).where((0,f.Uo)((0,f.eq)(i.users.email,d),(0,f.eq)(i.teamMembers.teamId,g.teamId))).limit(1)).length>0?{error:"User is already a member of this team"}:(await h.db.select().from(i.invitations).where((0,f.Uo)((0,f.eq)(i.invitations.email,d),(0,f.eq)(i.invitations.teamId,g.teamId),(0,f.eq)(i.invitations.status,"pending"))).limit(1)).length>0?{error:"An invitation has already been sent to this email"}:(await h.db.insert(i.invitations).values({teamId:g.teamId,email:d,role:e,invitedBy:c.id,status:"pending"}),await q(g.teamId,c.id,i.ActivityType.INVITE_TEAM_MEMBER),{success:"Invitation sent successfully"}):{error:"User is not part of a team"}});(0,p.D)([s,u,v,x,z,B,D,F]),(0,d.A)(s,"7ff875e5db7c94b068981f717440f5db940b738c52",null),(0,d.A)(u,"7fed2f9103ff574a6012a47865168d606b9eb3eafc",null),(0,d.A)(v,"00e95ad2c89bb61c8cdf69114d5e6a24e66a8cffe5",null),(0,d.A)(x,"7fb08e6b1c1a010650c7feed891eb298638feb910c",null),(0,d.A)(z,"7fb2b424d9b54b33cdab5ba905a91af41d23f9cf30",null),(0,d.A)(B,"7f1d4037a2a7082e61fca469c3f328a0c17d929cc9",null),(0,d.A)(D,"7f250916edc3d5cec2051f0b970ce00aa7efd056bc",null),(0,d.A)(F,"7f43afa96899bbe5a0ce9145216ba81e5ed1267893",null)},90177:(a,b,c)=>{Promise.resolve().then(c.bind(c,45183))},92486:(a,b,c)=>{"use strict";c.d(b,{UX:()=>g,jI:()=>f,u2:()=>h});var d=c(21074),e=c(90141);function f(a,b){return async(c,d)=>{let e=a.safeParse(Object.fromEntries(d));return e.success?b(e.data,d):{error:e.error.errors[0].message}}}function g(a,b){return async(c,e)=>{let f=await (0,d.wz)();if(!f)throw Error("User is not authenticated");let g=a.safeParse(Object.fromEntries(e));return g.success?b(g.data,e,f):{error:g.error.errors[0].message}}}function h(a){return async b=>{await (0,d.wz)()||(0,e.redirect)("/sign-in");let c=await (0,d.wK)();if(!c)throw Error("Team not found");return a(b,c)}}},96241:(a,b,c)=>{"use strict";c.d(b,{cn:()=>f});var d=c(49384),e=c(82348);function f(...a){return(0,e.QP)((0,d.$)(a))}}};